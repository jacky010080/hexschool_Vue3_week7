import{M as P,P as x,D as V}from"./PaginationView-b1ad4546.js";import{_ as O,o as s,c as l,d as e,t as o,g as y,F as _,f,h as k,k as v,r as p,b as m,n as C}from"./index-e9c23ee6.js";const L={props:["order"],data(){return{selectOrder:{},modal:"",isPaid:!1}},mounted(){this.modal=new P(document.querySelector("#orderModal"),{backdrop:"static",keyboard:!1})},watch:{order(){this.selectOrder=this.order}}},D={id:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog modal-xl"},A={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"productModalLabel",class:"modal-title"},[e("span",null,"訂單明細")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},T={class:"row"},U={class:"col-md-4"},B=e("h3",null,"用戶資料",-1),j={class:"table"},q={key:0},N=e("th",{style:{width:"40%"}},"姓名",-1),F=e("th",{style:{width:"40%"}},"電子郵件",-1),H=e("th",{style:{width:"40%"}},"電話",-1),R=e("th",{style:{width:"40%"}},"地址",-1),z={class:"col-md-8"},G=e("h3",null,"訂單明細",-1),J={class:"table"},K=e("th",{style:{width:"100px"}},"訂單編號",-1),Q=e("th",{style:{width:"100px"}},"下單時間",-1),W=e("th",{style:{width:"100px"}},"付款時間",-1),X={key:0},Y={key:1},Z=e("th",null,"付款狀態",-1),ee={key:0,class:"text-success"},te={key:1,class:"text-muted"},se=e("th",null,"總金額",-1),le=e("h3",null,"選購商品",-1),oe={class:"table"},de={class:"text-end"},ne={class:"d-flex justify-content-end"},ie={class:"form-check"},ae={class:"form-check-label",for:"isPaidCheck"},re={key:0},ce={key:1},he={class:"modal-body d-flex justify-content-end"},ue=e("button",{type:"button",class:"btn btn-outline-warning me-2","data-bs-dismiss":"modal"}," 取消 ",-1);function _e(d,n,r,u,t,h){return s(),l("div",D,[e("div",E,[e("div",A,[I,e("div",S,[e("div",T,[e("div",U,[B,e("table",j,[t.selectOrder.user?(s(),l("tbody",q,[e("tr",null,[N,e("td",null,o(t.selectOrder.user.name),1)]),e("tr",null,[F,e("td",null,o(t.selectOrder.user.email),1)]),e("tr",null,[H,e("td",null,o(t.selectOrder.user.tel),1)]),e("tr",null,[R,e("td",null,o(t.selectOrder.user.address),1)])])):y("",!0)])]),e("div",z,[G,e("table",J,[e("tbody",null,[e("tr",null,[K,e("td",null,o(t.selectOrder.id),1)]),e("tr",null,[Q,e("td",null,o(d.$filters.date(t.selectOrder.create_at)),1)]),e("tr",null,[W,e("td",null,[t.selectOrder.paid_date?(s(),l("span",X,o(d.$filters.date(t.selectOrder.paid_date)),1)):(s(),l("span",Y,"時間不正確"))])]),e("tr",null,[Z,e("td",null,[t.selectOrder.is_paid?(s(),l("span",ee,"已付款")):(s(),l("span",te,"未付款"))])]),e("tr",null,[se,e("td",null,o(d.$filters.currency(t.selectOrder.total)),1)])])]),le,e("table",oe,[e("tbody",null,[(s(!0),l(_,null,f(t.selectOrder.products,a=>(s(),l("tr",{key:a.id},[e("th",null,o(a.product.title),1),e("td",null,o(a.qty)+" / "+o(a.product.unit),1),e("td",de,o(a.total),1)]))),128))])]),e("div",ne,[e("div",ie,[k(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"isPaidCheck","onUpdate:modelValue":n[0]||(n[0]=a=>t.selectOrder.is_paid=a)},null,512),[[v,t.selectOrder.is_paid]]),e("label",ae,[t.selectOrder.is_paid?(s(),l("span",re,"已付款")):(s(),l("span",ce,"未付款"))])])])])])]),e("div",he,[ue,e("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=a=>d.$emit("update-order",t.selectOrder))}," 確認 ")])])])],512)}const pe=O(L,[["render",_e]]),{VITE_API:b,VITE_APIPATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/",VITE_APIPATH:"jacky010080",BASE_URL:"/hexschool_Vue3_main_week6/",MODE:"production",DEV:!1,PROD:!0},me={data(){return{orders:[],pagination:{},selectOrder:{},currentPage:1,isLoading:!1}},components:{PaginationView:x,OrderModal:pe,DeleteModal:V},methods:{getOrders(d=1){const n=`${b}/v2/api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.$http.get(n).then(r=>{this.isLoading=!1,this.orders=r.data.orders,this.pagination=r.data.pagination}).catch(r=>{alert(r.response.data.message),this.isLoading=!1})},updatePaidStatus(d){const n=`${b}/v2/api/${g}/admin/order/${d.id}`,r={is_paid:d.is_paid};this.isLoading=!0,this.$http.put(n,{data:r}).then(u=>{alert(u.data.message),this.isLoading=!1,this.getOrders(this.currentPage),this.$refs.orderModal.modal.hide()}).catch(u=>{alert(u.data.message),this.isLoading=!1})},openModal(d){this.selectOrder={...d},this.$refs.orderModal.modal.show()},openDelModal(d){this.selectOrder={...d},this.$refs.delModal.modal.show()},deleteOrder(){const d=`${b}/v2/api/${g}/admin/order/${this.selectOrder.id}`;this.isLoading=!0,this.$http.delete(d).then(n=>{alert(n.data.message),this.isLoading=!1,this.getOrders(this.currentPage),this.$refs.delModal.modal.hide()}).catch(n=>{alert(n.data.message),this.isLoading=!1})}},mounted(){this.getOrders()}},be={class:"container"},ge={class:"table mt-4"},ye=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"電子郵件"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),fe={key:0},Oe={class:"list-unstyled"},ke={class:"form-check form-switch"},ve=["onUpdate:modelValue","onChange"],Me={class:"form-check-label",for:"`paidSwitch_${order.id}`"},we={key:0},$e={key:1},Pe={class:"btn-group"},xe=["onClick"],Ve=["onClick"];function Ce(d,n,r,u,t,h){const a=p("PaginationView"),M=p("OrderModal"),w=p("DeleteModal");return s(),l(_,null,[e("div",be,[e("table",ge,[ye,e("tbody",null,[(s(!0),l(_,null,f(t.orders,i=>(s(),l(_,{key:i.id},[t.orders.length?(s(),l("tr",{key:0,class:C({"text-muted":i.is_paid})},[e("td",null,o(d.$filters.date(i.create_at)),1),e("td",null,[i.user?(s(),l("span",fe,o(i.user.email),1)):y("",!0)]),e("td",null,[e("ul",Oe,[(s(!0),l(_,null,f(i.products,(c,$)=>(s(),l("li",{key:$},o(c.product.title)+" / "+o(c.qty)+o(c.product.unit),1))),128))])]),e("td",null,o(i.total),1),e("td",null,[e("div",ke,[k(e("input",{class:"form-check-input",type:"checkbox",id:"`paidSwitch_${order.id}`","onUpdate:modelValue":c=>i.is_paid=c,onChange:c=>h.updatePaidStatus(i)},null,40,ve),[[v,i.is_paid]])]),e("label",Me,[i.is_paid?(s(),l("span",we,"已付款")):(s(),l("span",$e,"未付款"))])]),e("td",null,[e("div",Pe,[e("button",{type:"button",onClick:c=>h.openModal(i),class:"btn btn-outline-primary btn-sm"}," 檢視 ",8,xe),e("button",{type:"button",onClick:c=>h.openDelModal(i),class:"btn btn-outline-warning btn-sm"}," 刪除 ",8,Ve)])])],2)):y("",!0)],64))),128))])]),m(a,{pages:t.pagination,onEmitPage:h.getOrders},null,8,["pages","onEmitPage"])]),m(M,{ref:"orderModal",order:t.selectOrder,onUpdateOrder:h.updatePaidStatus},null,8,["order","onUpdateOrder"]),m(w,{ref:"delModal",item:t.selectOrder,onDelete:h.deleteOrder},null,8,["item","onDelete"])],64)}const Ee=O(me,[["render",Ce]]);export{Ee as default};
