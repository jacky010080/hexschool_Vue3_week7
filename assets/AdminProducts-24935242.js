import{M as V,D as x,P as M}from"./PaginationView-b1ad4546.js";import{_ as U,o as i,c as d,d as t,h as n,i as r,a as I,g as P,F as y,f as w,k as D,r as g,b as v,t as _}from"./index-e9c23ee6.js";const{VITE_API:A,VITE_APIPATH:E}={VITE_API:"https://vue3-course-api.hexschool.io/",VITE_APIPATH:"jacky010080",BASE_URL:"/hexschool_Vue3_main_week6/",MODE:"production",DEV:!1,PROD:!0},T={props:["isNew","product"],data(){return{status:{},modal:"",selectProduct:{}}},watch:{product(){this.selectProduct=this.product,this.selectProduct.imagesUrl||(this.selectProduct.imagesUrl=[]),this.selectProduct.imageUrl||(this.selectProduct.imageUrl="")}},methods:{uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l);const u=`${A}/v2/api/${E}/admin/upload`;this.status.fileUploading=!0,this.$http.post(u,e,{headers:{"Content-Type":"multipart/form-data"}}).then(m=>{this.status.fileUploading=!1,m.data.success&&(this.selectProduct.imageUrl=m.data.imageUrl,this.$refs.fileInput.value="")}).catch(m=>{this.status.fileUploading=!1,console.log(m)})},updateProduct(){this.$emit("update-product",this.selectProduct)}},mounted(){this.modal=new V(document.querySelector("#productModal"),{backdrop:"static",keyboard:!1})}},C={id:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true",ref:"modal"},F={class:"modal-dialog modal-xl"},N={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},B={id:"productModalLabel",class:"modal-title"},H={key:0},L={key:1},O=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},S={class:"row"},j={class:"col-sm-4"},q={class:"mb-3"},z=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),G={class:"mb-3"},J={for:"customFile",class:"form-label"},K={key:0,class:"fas fa-spinner fa-spin"},Q=["src"],W={key:0,class:"mt-5"},X={class:"mb-3"},Y=t("label",{for:"imgUrl",class:"form-label"},"圖片網址",-1),Z=["onUpdate:modelValue"],tt=["src"],et=["onClick"],st={key:0},ot={class:"col-sm-8"},lt={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"標題",-1),dt={class:"row"},ct={class:"mb-3 col-md-6"},nt=t("label",{for:"category",class:"form-label"},"分類",-1),at={class:"mb-3 col-md-6"},rt=t("label",{for:"price",class:"form-label"},"單位",-1),ut={class:"row"},mt={class:"mb-3 col-md-6"},pt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),ht={class:"mb-3 col-md-6"},_t=t("label",{for:"price",class:"form-label"},"售價",-1),bt=t("hr",null,null,-1),ft={class:"mb-3"},Pt=t("label",{for:"description",class:"form-label"},"產品描述",-1),gt={class:"mb-3"},vt=t("label",{for:"content",class:"form-label"},"說明內容",-1),yt={class:"mb-3"},Ut={class:"form-check"},wt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),kt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-warning","data-bs-dismiss":"modal"}," 取消 ",-1);function xt(l,e,u,m,s,c){return i(),d("div",C,[t("div",F,[t("div",N,[t("div",$,[t("h5",B,[u.isNew?(i(),d("span",H,"新增產品")):(i(),d("span",L,"編輯產品"))]),O]),t("div",R,[t("div",S,[t("div",j,[t("div",q,[z,n(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":e[0]||(e[0]=o=>s.selectProduct.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[r,s.selectProduct.imageUrl]])]),t("div",G,[t("label",J,[I("或 上傳圖片 "),s.status.fileUploading?(i(),d("i",K)):P("",!0)]),t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:e[1]||(e[1]=(...o)=>c.uploadFile&&c.uploadFile(...o))},null,544)]),t("img",{class:"img-fluid",src:s.selectProduct.imageUrl},null,8,Q),Array.isArray(s.selectProduct.imagesUrl)?(i(),d("div",W,[(i(!0),d(y,null,w(s.selectProduct.imagesUrl,(o,p)=>(i(),d("div",{class:"mb-3",key:p},[t("div",X,[Y,n(t("input",{type:"url",class:"form-control mb-2",placeholder:"請輸入圖片連結","onUpdate:modelValue":h=>s.selectProduct.imagesUrl[p]=h},null,8,Z),[[r,s.selectProduct.imagesUrl[p]]])]),t("img",{class:"img-fluid",src:o},null,8,tt),t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:h=>s.selectProduct.imagesUrl.splice(p,1)}," 刪除圖片 ",8,et)]))),128)),!s.selectProduct.imagesUrl.length||s.selectProduct.imagesUrl.at(-1)?(i(),d("div",st,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=o=>s.selectProduct.imagesUrl.push(""))}," 新增圖片 ")])):P("",!0)])):P("",!0)]),t("div",ot,[t("div",lt,[it,n(t("input",{id:"title",type:"text",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=o=>s.selectProduct.title=o),placeholder:"請輸入標題"},null,512),[[r,s.selectProduct.title]])]),t("div",dt,[t("div",ct,[nt,n(t("input",{id:"category",type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=o=>s.selectProduct.category=o),placeholder:"請輸入分類"},null,512),[[r,s.selectProduct.category]])]),t("div",at,[rt,n(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":e[5]||(e[5]=o=>s.selectProduct.unit=o),placeholder:"請輸入單位"},null,512),[[r,s.selectProduct.unit]])])]),t("div",ut,[t("div",mt,[pt,n(t("input",{type:"number",class:"form-control",id:"origin_price",min:"0","onUpdate:modelValue":e[6]||(e[6]=o=>s.selectProduct.origin_price=o),placeholder:"請輸入原價"},null,512),[[r,s.selectProduct.origin_price,void 0,{number:!0}]])]),t("div",ht,[_t,n(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[7]||(e[7]=o=>s.selectProduct.price=o),min:"0",placeholder:"請輸入售價"},null,512),[[r,s.selectProduct.price,void 0,{number:!0}]])])]),bt,t("div",ft,[Pt,n(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[8]||(e[8]=o=>s.selectProduct.description=o),placeholder:"請輸入產品描述"},null,512),[[r,s.selectProduct.description]])]),t("div",gt,[vt,n(t("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":e[9]||(e[9]=o=>s.selectProduct.content=o),placeholder:"請輸入說明內容"},null,512),[[r,s.selectProduct.content]])]),t("div",yt,[t("div",Ut,[n(t("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":e[10]||(e[10]=o=>s.selectProduct.is_enabled=o),"true-value":1,"false-value":0},null,512),[[D,s.selectProduct.is_enabled]]),wt])])])])]),t("div",kt,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=(...o)=>c.updateProduct&&c.updateProduct(...o))}," 確認 ")])])])],512)}const Mt=U(T,[["render",xt]]),{VITE_API:b,VITE_APIPATH:f}={VITE_API:"https://vue3-course-api.hexschool.io/",VITE_APIPATH:"jacky010080",BASE_URL:"/hexschool_Vue3_main_week6/",MODE:"production",DEV:!1,PROD:!0},It={data(){return{products:[],isNew:!1,tempProduct:{imagesUrl:[]},page:{}}},components:{ProductModal:Mt,DeleteModal:x,PaginationView:M},methods:{getData(l=1){this.$http.get(`${b}/v2/api/${f}/admin/products/?page=${l}`).then(e=>{this.products=e.data.products,this.page=e.data.pagination}).catch(e=>{alert(e.response.data.message)})},openModal(l,e){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productModal.modal.show()):l==="edit"?(this.tempProduct={...e},this.isNew=!1,this.$refs.productModal.modal.show()):l==="delete"&&(this.tempProduct={...e},this.$refs.delModal.modal.show())},createImages(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},updateProduct(){let l="post",e=`${b}/v2/api/${f}/admin/product`;this.isNew||(l="put",e=`${b}/v2/api/${f}/admin/product/${this.tempProduct.id}`),this.$http[l](e,{data:this.tempProduct}).then(u=>{alert(u.data.message),this.$refs.productModal.modal.hide(),this.getData()}).catch(u=>{alert(u.data.message)})},deleteProduct(){this.$http.delete(`${b}/v2/api/${f}/admin/product/${this.tempProduct.id}`).then(l=>{alert(l.data.message),this.$refs.delModal.modal.hide(),this.getData()}).catch(l=>{alert(l.data.message)})}},mounted(){this.getData()}},Dt={class:"container"},At={class:"text-end mt-4"},Et={class:"table mt-4"},Tt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Ct={class:"text-end"},Ft={class:"text-end"},Nt={key:0,class:"text-success"},$t={key:1},Bt={class:"btn-group"},Ht=["onClick"],Lt=["onClick"];function Ot(l,e,u,m,s,c){const o=g("PaginationView"),p=g("ProductModal"),h=g("DeleteModal");return i(),d(y,null,[t("div",Dt,[t("div",At,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=a=>c.openModal("new"))}," 建立新的產品 ")]),t("table",Et,[Tt,t("tbody",null,[(i(!0),d(y,null,w(s.products,a=>(i(),d("tr",{key:a.id},[t("td",null,_(a.category),1),t("td",null,_(a.title),1),t("td",Ct,_(a.origin_price),1),t("td",Ft,_(a.price),1),t("td",null,[a.is_enabled?(i(),d("span",Nt,"啟用")):(i(),d("span",$t,"未啟用"))]),t("td",null,[t("div",Bt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:k=>c.openModal("edit",a)}," 編輯 ",8,Ht),t("button",{type:"button",class:"btn btn-outline-warning btn-sm",onClick:k=>c.openModal("delete",a)}," 刪除 ",8,Lt)])])]))),128))])]),v(o,{pages:s.page,onEmitPage:c.getData},null,8,["pages","onEmitPage"])]),v(p,{ref:"productModal","is-new":s.isNew,product:s.tempProduct,onUpdateProduct:c.updateProduct},null,8,["is-new","product","onUpdateProduct"]),v(h,{ref:"delModal",item:s.tempProduct,onDelete:c.deleteProduct},null,8,["item","onDelete"])],64)}const jt=U(It,[["render",Ot]]);export{jt as default};
